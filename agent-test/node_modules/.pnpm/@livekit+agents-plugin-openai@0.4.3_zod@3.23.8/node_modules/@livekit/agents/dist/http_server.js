// SPDX-FileCopyrightText: 2024 LiveKit, Inc.
//
// SPDX-License-Identifier: Apache-2.0
import { createServer } from 'node:http';
import { log } from './log.js';
const healthCheck = async (res) => {
    res.writeHead(200);
    res.end('OK');
};
export class HTTPServer {
    host;
    port;
    app;
    #logger = log();
    constructor(host, port) {
        this.host = host;
        this.port = port;
        this.app = createServer((req, res) => {
            if (req.url === '/') {
                healthCheck(res);
            }
            else {
                res.writeHead(404);
                res.end('not found');
            }
        });
    }
    async run() {
        return new Promise((resolve, reject) => {
            this.app.listen(this.port, this.host, (err) => {
                if (err)
                    reject(err);
                const address = this.app.address();
                if (typeof address !== 'string') {
                    this.#logger.info(`Server is listening on port ${address.port}`);
                }
                resolve();
            });
        });
    }
    async close() {
        return new Promise((resolve, reject) => {
            this.app.close((err) => {
                if (err)
                    reject(err);
                resolve();
            });
        });
    }
}
//# sourceMappingURL=http_server.js.map